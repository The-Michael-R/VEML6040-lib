<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Simple VEML6040 library with example: inc/veml6040.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Simple VEML6040 library with example
   </div>
   <div id="projectbrief">A small library allowing to read the VEML6040</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">veml6040.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;sys/ioctl.h&gt;</code><br />
<code>#include &lt;linux/i2c.h&gt;</code><br />
<code>#include &lt;linux/i2c-dev.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="veml6040_8h_source.html">veml6040.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aafc98692d830cbd0997af99c5b6e994d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veml6040_8c.html#aafc98692d830cbd0997af99c5b6e994d">veml6040_init</a> ()</td></tr>
<tr class="separator:aafc98692d830cbd0997af99c5b6e994d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade51804efe7960f2a9b3125aa6f82b1e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="error__codes_8h.html#ac6886c3dac8e0ce47d8f74d206f6b2af">ERROR_CODE_T</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veml6040_8c.html#ade51804efe7960f2a9b3125aa6f82b1e">i2c_read</a> (const uint8_t addr, uint16_t *data)</td></tr>
<tr class="separator:ade51804efe7960f2a9b3125aa6f82b1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c6d597315c579318ecd58ee295d6e4c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="error__codes_8h.html#ac6886c3dac8e0ce47d8f74d206f6b2af">ERROR_CODE_T</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veml6040_8c.html#a8c6d597315c579318ecd58ee295d6e4c">i2c_write_byte</a> (const uint8_t addr, const uint8_t data)</td></tr>
<tr class="separator:a8c6d597315c579318ecd58ee295d6e4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbd844d9487daebc8bd04baa389cd1d1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="error__codes_8h.html#ac6886c3dac8e0ce47d8f74d206f6b2af">ERROR_CODE_T</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veml6040_8c.html#adbd844d9487daebc8bd04baa389cd1d1">sample_veml</a> (uint32_t *raw_rgbw)</td></tr>
<tr class="separator:adbd844d9487daebc8bd04baa389cd1d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a011cb60290243a4a171ed466762c7bc5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veml6040_8c.html#a011cb60290243a4a171ed466762c7bc5">convert_luminance</a> (const uint32_t *raw_rgbw, float *lux_rgbw)</td></tr>
<tr class="separator:a011cb60290243a4a171ed466762c7bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a545357ffa73ad118ef4eafd9a6f63921"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veml6040_8c.html#a545357ffa73ad118ef4eafd9a6f63921">i2c_file_handle</a></td></tr>
<tr class="separator:a545357ffa73ad118ef4eafd9a6f63921"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a011cb60290243a4a171ed466762c7bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a011cb60290243a4a171ed466762c7bc5">&#9670;&nbsp;</a></span>convert_luminance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void convert_luminance </td>
          <td>(</td>
          <td class="paramtype">const uint32_t *&#160;</td>
          <td class="paramname"><em>raw_rgbw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>lux_rgbw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Convert the RAW values to lux. It simply multiplies the RAW value with 0.007865</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">const</td><td>raw_rgbw Array that holds the RAw values provided from the function sample_veml </td></tr>
    <tr><td class="paramname">*lux_rgbw</td><td>Pointer to an array of floats. This array will have the values in lux after the function call. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ade51804efe7960f2a9b3125aa6f82b1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade51804efe7960f2a9b3125aa6f82b1e">&#9670;&nbsp;</a></span>i2c_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="error__codes_8h.html#ac6886c3dac8e0ce47d8f74d206f6b2af">ERROR_CODE_T</a> i2c_read </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read 16bit (word) from i2c device from provided address. This code uses the correct approach of reading the value. Split this to two i2c commands isn't valid and the veml6040 won't respond to that construct. So the ioctl() is used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">addr</td><td>Address of word to be read from i2c device </td></tr>
    <tr><td class="paramname">*data</td><td>Pointer to uint16_t memory. If i2c read was successful data will be updated. Otherwise the value will be unchanged. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code as defined in <a class="el" href="error__codes_8h.html">error_codes.h</a> </dd></dl>

</div>
</div>
<a id="a8c6d597315c579318ecd58ee295d6e4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c6d597315c579318ecd58ee295d6e4c">&#9670;&nbsp;</a></span>i2c_write_byte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="error__codes_8h.html#ac6886c3dac8e0ce47d8f74d206f6b2af">ERROR_CODE_T</a> i2c_write_byte </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Writing 16bit (word) to the i2c device.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">addr</td><td>Address of word to be written to i2c device </td></tr>
    <tr><td class="paramname">data</td><td>Data of uint16_t that will be written to i2c device </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code as defined in <a class="el" href="error__codes_8h.html">error_codes.h</a> </dd></dl>

</div>
</div>
<a id="adbd844d9487daebc8bd04baa389cd1d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbd844d9487daebc8bd04baa389cd1d1">&#9670;&nbsp;</a></span>sample_veml()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="error__codes_8h.html#ac6886c3dac8e0ce47d8f74d206f6b2af">ERROR_CODE_T</a> sample_veml </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>raw_rgbw</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read all four channels form veml6040. To get the full dynamic range of the device this code tries the shortest integration time and increases until all channels are in the optimal range or the longest integration tie is reached.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">raw_rgbw</td><td>Pointer to array of uint32_t. This array will hold the current values of lumince in the order of red, green, blue, white. Each step represents 0.007865 Lux. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aafc98692d830cbd0997af99c5b6e994d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafc98692d830cbd0997af99c5b6e994d">&#9670;&nbsp;</a></span>veml6040_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int veml6040_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialízes the i2c interface and the veml6040 device </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a545357ffa73ad118ef4eafd9a6f63921"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a545357ffa73ad118ef4eafd9a6f63921">&#9670;&nbsp;</a></span>i2c_file_handle</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int i2c_file_handle</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A library I wrote for the VEML6040 sensor from Vishay Semiconductors. This is a private project and not related to Vishay Semiconductors.</p>
<p>Configures and collect the results of the VEML6040</p>
<p>Providing the RAW values as from the sensor and the function to convert this values to LUX.</p>
<p>Public functions: int <a class="el" href="veml6040_8c.html#aafc98692d830cbd0997af99c5b6e994d">veml6040_init()</a> ERROR_CODE_T <a class="el" href="veml6040_8c.html#adbd844d9487daebc8bd04baa389cd1d1">sample_veml(uint32_t *raw_rgbw)</a> void <a class="el" href="veml6040_8c.html#a011cb60290243a4a171ed466762c7bc5">convert_luminance(const uint32_t *raw_rgbw, float *lux_rgbw)</a> Private stuff </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
